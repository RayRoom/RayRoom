<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Mesh Viewer</title>
    <style>
        body { margin: 0; font-family: sans-serif; }
        canvas { display: block; }
        #sidebar {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 250px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 5px;
            padding: 10px;
            max-height: 90vh;
            overflow-y: auto;
        }
        #sidebar h2 {
            margin-top: 0;
            font-size: 1.1em;
        }
        .control {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .control label {
            margin-right: 10px;
        }
        #objectList {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        #objectList li {
            padding: 4px 0;
            display: flex;
            align-items: center;
        }
        #objectList input {
            margin-right: 8px;
        }
        .object-label .name {
            font-weight: bold;
        }
        .object-label .description {
            font-size: 0.9em;
            color: #555;
            margin-left: 5px;
        }
        #camera-info {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #ccc;
        }
        #camera-info h3 {
            margin-top: 0;
            font-size: 1em;
            color: #333;
        }
        #camera-info p {
            font-size: 0.9em;
            margin: 5px 0 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <h2>Room Objects</h2>
        <div class="control">
            <input type="checkbox" id="transparencyToggle" checked>
            <label for="transparencyToggle">Ghost View</label>
        </div>
        <div class="control">
            <input type="checkbox" id="edgesToggle" checked>
            <label for="edgesToggle">Show Edges</label>
        </div>
        <div class="control">
            <input type="checkbox" id="verticesToggle">
            <label for="verticesToggle">Show Vertices</label>
        </div>
        <div class="control">
            <input type="checkbox" id="furnitureToggle" checked>
            <label for="furnitureToggle">Show Furniture</label>
        </div>
        <ul id="objectList"></ul>

        <div id="camera-info">
            <h3>Camera Info</h3>
            <p id="camera-position">Position: (0.00, 0.00, 0.00)</p>
            <p id="camera-rotation">Rotation: (0.00, 0.00, 0.00)</p>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.165.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.165.0/examples/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xdddddd);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.up.set(0, 0, 1); // Z is up

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        
        const objContent = `# RayRoom Room Geometry
o Floor
v 4 0 0
v 4 2 0
v 0 2 0
v 0 0 0
f 1 2 3 4
o Ceiling
v 0.0 2.0 2.5
v 4.0 2.0 2.5
v 4.0 0.0 2.5
v 0.0 0.0 2.5
f 5 6 7 8
o Front
v 0.0 0.0 2.5
v 4.0 0.0 2.5
v 4.0 0.0 0.0
v 0.0 0.0 0.0
f 9 10 11 12
o Back
v 4.0 2.0 2.5
v 0.0 2.0 2.5
v 0.0 2.0 0.0
v 4.0 2.0 0.0
f 13 14 15 16
o Left
v 0.0 2.0 2.5
v 0.0 0.0 2.5
v 0.0 0.0 0.0
v 0.0 2.0 0.0
f 17 18 19 20
o Right
v 4.0 0.0 2.5
v 4.0 2.0 2.5
v 4.0 2.0 0.0
v 4.0 0.0 0.0
f 21 22 23 24
o Person 1
v 0.6499999999999999 1.25 0.68
v 0.65 1.75 0.68
v 0.35000000000000003 1.75 0.68
v 0.35 1.25 0.68
v 0.6499999999999999 1.25 1.445
v 0.65 1.75 1.445
v 0.35000000000000003 1.75 1.445
v 0.35 1.25 1.445
v 0.62 1.375 1.445
v 0.62 1.625 1.445
v 0.38 1.625 1.445
v 0.38 1.375 1.445
v 0.62 1.375 1.7000000000000002
v 0.62 1.625 1.7000000000000002
v 0.38 1.625 1.7000000000000002
v 0.38 1.375 1.7000000000000002
v 0.62 1.3125 0.0
v 0.62 1.4375 0.0
v 0.38 1.4375 0.0
v 0.38 1.3125 0.0
v 0.62 1.3125 0.68
v 0.62 1.4375 0.68
v 0.38 1.4375 0.68
v 0.38 1.3125 0.68
v 0.62 1.5625 0.0
v 0.62 1.6875 0.0
v 0.38 1.6875 0.0
v 0.38 1.5625 0.0
v 0.62 1.5625 0.68
v 0.62 1.6875 0.68
v 0.38 1.6875 0.68
v 0.38 1.5625 0.68
v 0.62 1.15 0.68
v 0.62 1.25 0.68
v 0.38 1.25 0.68
v 0.38 1.15 0.68
v 0.62 1.15 1.3685
v 0.62 1.25 1.3685
v 0.38 1.25 1.3685
v 0.38 1.15 1.3685
v 0.62 1.75 0.68
v 0.62 1.85 0.68
v 0.38 1.85 0.68
v 0.38 1.75 0.68
v 0.62 1.75 1.3685
v 0.62 1.85 1.3685
v 0.38 1.85 1.3685
v 0.38 1.75 1.3685
f 25 26 27 28
f 29 32 31 30
f 25 29 30 26
f 26 30 31 27
f 27 31 32 28
f 28 32 29 25
f 33 34 35 36
f 37 40 39 38
f 33 37 38 34
f 34 38 39 35
f 35 39 40 36
f 36 40 37 33
f 41 42 43 44
f 45 48 47 46
f 41 45 46 42
f 42 46 47 43
f 43 47 48 44
f 44 48 45 41
f 49 50 51 52
f 53 56 55 54
f 49 53 54 50
f 50 54 55 51
f 51 55 56 52
f 52 56 53 49
f 57 58 59 60
f 61 64 63 62
f 57 61 62 58
f 58 62 63 59
f 59 63 64 60
f 60 64 61 57
f 65 66 67 68
f 69 72 71 70
f 65 69 70 66
f 66 70 71 67
f 67 71 72 68
f 68 72 69 65
o Person 2
v 3.35 1.75 0.68
v 3.35 1.25 0.68
v 3.65 1.25 0.68
v 3.65 1.75 0.68
v 3.35 1.75 1.445
v 3.35 1.25 1.445
v 3.65 1.25 1.445
v 3.65 1.75 1.445
v 3.38 1.625 1.445
v 3.38 1.375 1.445
v 3.62 1.375 1.445
v 3.62 1.625 1.445
v 3.38 1.625 1.7000000000000002
v 3.38 1.375 1.7000000000000002
v 3.62 1.375 1.7000000000000002
v 3.62 1.625 1.7000000000000002
v 3.38 1.6875 0.0
v 3.38 1.5625 0.0
v 3.62 1.5625 0.0
v 3.62 1.6875 0.0
v 3.38 1.6875 0.68
v 3.38 1.5625 0.68
v 3.62 1.5625 0.68
v 3.62 1.6875 0.68
v 3.38 1.4375 0.0
v 3.38 1.3125 0.0
v 3.62 1.3125 0.0
v 3.62 1.4375 0.0
v 3.38 1.4375 0.68
v 3.38 1.3125 0.68
v 3.62 1.3125 0.68
v 3.62 1.4375 0.68
v 3.38 1.85 0.68
v 3.38 1.75 0.68
v 3.62 1.75 0.68
v 3.62 1.85 0.68
v 3.38 1.85 1.3685
v 3.38 1.75 1.3685
v 3.62 1.75 1.3685
v 3.62 1.85 1.3685
v 3.38 1.25 0.68
v 3.38 1.15 0.68
v 3.62 1.15 0.68
v 3.62 1.25 0.68
v 3.38 1.25 1.3685
v 3.38 1.15 1.3685
v 3.62 1.15 1.3685
v 3.62 1.25 1.3685
f 73 74 75 76
f 77 80 79 78
f 73 77 78 74
f 74 78 79 75
f 75 79 80 76
f 76 80 77 73
f 81 82 83 84
f 85 88 87 86
f 81 85 86 82
f 82 86 87 83
f 83 87 88 84
f 84 88 85 81
f 89 90 91 92
f 93 96 95 94
f 89 93 94 90
f 90 94 95 91
f 91 95 96 92
f 92 96 93 89
f 97 98 99 100
f 101 104 103 102
f 97 101 102 98
f 98 102 103 99
f 99 103 104 100
f 100 104 101 97
f 105 106 107 108
f 109 112 111 110
f 105 109 110 106
f 106 110 111 107
f 107 111 112 108
f 108 112 109 105
f 113 114 115 116
f 117 120 119 118
f 113 117 118 114
f 114 118 119 115
f 115 119 120 116
f 116 120 117 113
o Chair
v 0.14644660940672627 0.65 0.4
v 0.5 0.2964466094067263 0.4
v 0.8535533905932737 0.65 0.4
v 0.5 1.0035533905932739 0.4
v 0.14644660940672627 0.65 0.45
v 0.5 0.2964466094067263 0.45
v 0.8535533905932737 0.65 0.45
v 0.5 1.0035533905932739 0.45
v 0.14644660940672627 0.65 0.425
v 0.5 0.2964466094067263 0.425
v 0.5353553390593274 0.33180194846605365 0.425
v 0.18180194846605363 0.6853553390593273 0.425
v 0.14644660940672627 0.65 0.925
v 0.5 0.2964466094067263 0.925
v 0.5353553390593274 0.33180194846605365 0.925
v 0.18180194846605363 0.6853553390593273 0.925
v 0.14644660940672627 0.65 0.0
v 0.17473088065418813 0.6217157287525381 0.0
v 0.20301515190165004 0.65 0.0
v 0.17473088065418813 0.6782842712474619 0.0
v 0.14644660940672627 0.65 0.4
v 0.17473088065418813 0.6217157287525381 0.4
v 0.20301515190165004 0.65 0.4
v 0.17473088065418813 0.6782842712474619 0.4
v 0.47171572875253814 0.32473088065418815 0.0
v 0.5 0.2964466094067263 0.0
v 0.5282842712474619 0.32473088065418815 0.0
v 0.5 0.35301515190165006 0.0
v 0.47171572875253814 0.32473088065418815 0.4
v 0.5 0.2964466094067263 0.4
v 0.5282842712474619 0.32473088065418815 0.4
v 0.5 0.35301515190165006 0.4
v 0.4717157287525381 0.9752691193458118 0.0
v 0.49999999999999994 0.94698484809835 0.0
v 0.5282842712474618 0.9752691193458118 0.0
v 0.5 1.0035533905932739 0.0
v 0.4717157287525381 0.9752691193458118 0.4
v 0.49999999999999994 0.94698484809835 0.4
v 0.5282842712474618 0.9752691193458118 0.4
v 0.5 1.0035533905932739 0.4
v 0.7969848480983499 0.65 0.0
v 0.8252691193458119 0.6217157287525381 0.0
v 0.8535533905932737 0.65 0.0
v 0.8252691193458119 0.6782842712474619 0.0
v 0.7969848480983499 0.65 0.4
v 0.8252691193458119 0.6217157287525381 0.4
v 0.8535533905932737 0.65 0.4
v 0.8252691193458119 0.6782842712474619 0.4
f 121 122 123 124
f 125 128 127 126
f 121 125 126 122
f 122 126 127 123
f 123 127 128 124
f 124 128 125 121
f 129 130 131 132
f 133 136 135 134
f 129 133 134 130
f 130 134 135 131
f 131 135 136 132
f 132 136 133 129
f 137 138 139 140
f 141 144 143 142
f 137 141 142 138
f 138 142 143 139
f 139 143 144 140
f 140 144 141 137
f 145 146 147 148
f 149 152 151 150
f 145 149 150 146
f 146 150 151 147
f 147 151 152 148
f 148 152 149 145
f 153 154 155 156
f 157 160 159 158
f 153 157 158 154
f 154 158 159 155
f 155 159 160 156
f 156 160 157 153
f 161 162 163 164
f 165 168 167 166
f 161 165 166 162
f 162 166 167 163
f 163 167 168 164
f 164 168 165 161
o Couch
v 1.9430253861447007 0.06455664311105636 0.0
v 3.9354147823281913 0.23886812860637263 0.0
v 3.856974613855299 1.1354433568889437 0.0
v 1.8645852176718083 0.9611318713936273 0.0
v 1.9430253861447007 0.06455664311105636 0.4
v 3.9354147823281913 0.23886812860637263 0.4
v 3.856974613855299 1.1354433568889437 0.4
v 1.8645852176718083 0.9611318713936273 0.4
v 1.9430253861447007 0.06455664311105636 0.4
v 3.9354147823281913 0.2388681286063727 0.4
v 3.91798363377866 0.4381070682247218 0.4
v 1.925594237595169 0.26379558272940545 0.4
v 1.9430253861447007 0.06455664311105636 0.8
v 3.9354147823281913 0.2388681286063727 0.8
v 3.91798363377866 0.4381070682247218 0.8
v 1.925594237595169 0.26379558272940545 0.8
v 1.9430253861447007 0.06455664311105636 0.4
v 2.1422643257630494 0.0819877916605879 0.4
v 2.0638241572901572 0.978563019943159 0.4
v 1.8645852176718083 0.9611318713936273 0.4
v 1.9430253861447007 0.06455664311105636 0.6000000000000001
v 2.1422643257630494 0.0819877916605879 0.6000000000000001
v 2.0638241572901572 0.978563019943159 0.6000000000000001
v 1.8645852176718083 0.9611318713936273 0.6000000000000001
v 3.7361758427098426 0.22143698005684098 0.4
v 3.9354147823281913 0.23886812860637263 0.4
v 3.856974613855299 1.1354433568889437 0.4
v 3.6577356742369505 1.1180122083394122 0.4
v 3.7361758427098426 0.22143698005684098 0.6000000000000001
v 3.9354147823281913 0.23886812860637263 0.6000000000000001
v 3.856974613855299 1.1354433568889437 0.6000000000000001
v 3.6577356742369505 1.1180122083394122 0.6000000000000001
f 169 170 171 172
f 173 176 175 174
f 169 173 174 170
f 170 174 175 171
f 171 175 176 172
f 172 176 173 169
f 177 178 179 180
f 181 184 183 182
f 177 181 182 178
f 178 182 183 179
f 179 183 184 180
f 180 184 181 177
f 185 186 187 188
f 189 192 191 190
f 185 189 190 186
f 186 190 191 187
f 187 191 192 188
f 188 192 189 185
f 193 194 195 196
f 197 200 199 198
f 193 197 198 194
f 194 198 199 195
f 195 199 200 196
f 196 200 197 193
o CoffeeTable
v 2.023691586641042 1.2073734541032346 0.36
v 3.019886284732787 1.2945291968508927 0.36
v 2.976308413358958 1.7926265458967654 0.36
v 1.9801137152672128 1.7054708031491073 0.36
v 2.023691586641042 1.2073734541032346 0.39999999999999997
v 3.019886284732787 1.2945291968508927 0.39999999999999997
v 2.976308413358958 1.7926265458967654 0.39999999999999997
v 1.9801137152672128 1.7054708031491073 0.39999999999999997
v 2.0527058701563177 1.2199500733665818 0.0
v 2.0925536580799875 1.223436303076488 0.0
v 2.089067428370081 1.263284091000158 0.0
v 2.0492196404464114 1.2597978612902516 0.0
v 2.0527058701563177 1.2199500733665818 0.36
v 2.0925536580799875 1.223436303076488 0.36
v 2.089067428370081 1.263284091000158 0.36
v 2.0492196404464114 1.2597978612902516 0.36
v 2.9492810984388886 1.2983902418394742 0.0
v 2.9891288863625585 1.3018764715493805 0.0
v 2.985642656652652 1.3417242594730503 0.0
v 2.9457948687289823 1.338238029763144 0.0
v 2.9492810984388886 1.2983902418394742 0.36
v 2.9891288863625585 1.3018764715493805 0.36
v 2.985642656652652 1.3417242594730503 0.36
v 2.9457948687289823 1.338238029763144 0.36
v 2.014357343347348 1.6582757405269497 0.0
v 2.0542051312710177 1.661761970236856 0.0
v 2.0507189015611114 1.7016097581605258 0.0
v 2.0108711136374415 1.6981235284506195 0.0
v 2.014357343347348 1.6582757405269497 0.36
v 2.0542051312710177 1.661761970236856 0.36
v 2.0507189015611114 1.7016097581605258 0.36
v 2.0108711136374415 1.6981235284506195 0.36
v 2.910932571629919 1.736715908999842 0.0
v 2.9507803595535886 1.7402021387097484 0.0
v 2.9472941298436823 1.7800499266334182 0.0
v 2.9074463419200125 1.776563696923512 0.0
v 2.910932571629919 1.736715908999842 0.36
v 2.9507803595535886 1.7402021387097484 0.36
v 2.9472941298436823 1.7800499266334182 0.36
v 2.9074463419200125 1.776563696923512 0.36
f 201 202 203 204
f 205 208 207 206
f 201 205 206 202
f 202 206 207 203
f 203 207 208 204
f 204 208 205 201
f 209 210 211 212
f 213 216 215 214
f 209 213 214 210
f 210 214 215 211
f 211 215 216 212
f 212 216 213 209
f 217 218 219 220
f 221 224 223 222
f 217 221 222 218
f 218 222 223 219
f 219 223 224 220
f 220 224 221 217
f 225 226 227 228
f 229 232 231 230
f 225 229 230 226
f 226 230 231 227
f 227 231 232 228
f 228 232 229 225
f 233 234 235 236
f 237 240 239 238
f 233 237 238 234
f 234 238 239 235
f 235 239 240 236
f 236 240 237 233
o Door 1
v 0.024999999999999974 1.05 0.0
v 0.02500000000000003 1.95 0.0
v -0.024999999999999974 1.95 0.0
v -0.02500000000000003 1.05 0.0
v 0.024999999999999974 1.05 2.0
v 0.02500000000000003 1.95 2.0
v -0.024999999999999974 1.95 2.0
v -0.02500000000000003 1.05 2.0
v 0.025000000000000022 1.8599999999999999 1.0
v 0.025000000000000022 1.855 1.0086602540378444
v 0.025000000000000022 1.845 1.0086602540378444
v 0.025000000000000022 1.8399999999999999 1.0
v 0.025000000000000022 1.845 0.9913397459621556
v 0.025000000000000022 1.855 0.9913397459621556
v 0.07500000000000004 1.8599999999999999 1.0
v 0.07500000000000004 1.855 1.0086602540378444
v 0.07500000000000004 1.845 1.0086602540378444
v 0.07500000000000004 1.8399999999999999 1.0
v 0.07500000000000004 1.845 0.9913397459621556
v 0.07500000000000004 1.855 0.9913397459621556
v 0.025000000000000022 1.85 1.0
v 0.07500000000000004 1.85 1.0
v 0.07500000000000004 1.85 1.03
v 0.07500000000000004 1.85 1.03
v 0.07500000000000004 1.85 1.03
v 0.07500000000000004 1.85 1.03
v 0.07500000000000004 1.85 1.03
v 0.07500000000000004 1.85 1.03
v 0.07500000000000004 1.85 1.03
v 0.07500000000000004 1.865 1.025980762113533
v 0.06200961894323346 1.8575 1.025980762113533
v 0.06200961894323345 1.8425 1.025980762113533
v 0.07500000000000002 1.835 1.025980762113533
v 0.08799038105676661 1.8425 1.025980762113533
v 0.08799038105676661 1.8575 1.025980762113533
v 0.07500000000000004 1.865 1.025980762113533
v 0.07500000000000004 1.8759807621135332 1.015
v 0.05250000000000004 1.8629903810567665 1.015
v 0.05250000000000003 1.8370096189432334 1.015
v 0.07500000000000002 1.8240192378864668 1.015
v 0.09750000000000002 1.8370096189432334 1.015
v 0.09750000000000003 1.8629903810567665 1.015
v 0.07500000000000004 1.8759807621135332 1.015
v 0.07500000000000004 1.88 1.0
v 0.04901923788646687 1.865 1.0
v 0.04901923788646687 1.835 1.0
v 0.07500000000000002 1.8199999999999998 1.0
v 0.10098076211353317 1.835 1.0
v 0.1009807621135332 1.865 1.0
v 0.07500000000000005 1.88 1.0
v 0.07500000000000004 1.8759807621135332 0.985
v 0.05250000000000003 1.8629903810567665 0.985
v 0.052500000000000026 1.8370096189432334 0.985
v 0.07500000000000002 1.8240192378864668 0.985
v 0.09750000000000002 1.8370096189432334 0.985
v 0.09750000000000003 1.8629903810567665 0.985
v 0.07500000000000004 1.8759807621135332 0.985
v 0.07500000000000004 1.865 0.9740192378864668
v 0.06200961894323346 1.8575 0.9740192378864668
v 0.06200961894323345 1.8425 0.9740192378864668
v 0.07500000000000002 1.835 0.9740192378864668
v 0.08799038105676661 1.8425 0.9740192378864668
v 0.08799038105676661 1.8575 0.9740192378864668
v 0.07500000000000004 1.865 0.9740192378864668
v 0.07500000000000004 1.85 0.97
v 0.07500000000000004 1.85 0.97
v 0.07500000000000004 1.85 0.97
v 0.07500000000000004 1.85 0.97
v 0.07500000000000004 1.85 0.97
v 0.07500000000000004 1.85 0.97
v 0.07500000000000004 1.85 0.97
f 241 242 243 244
f 245 248 247 246
f 241 245 246 242
f 242 246 247 243
f 243 247 248 244
f 244 248 245 241
f 249 255 256 250
f 250 256 257 251
f 251 257 258 252
f 252 258 259 253
f 253 259 260 254
f 254 260 255 249
f 261 249 250
f 261 250 251
f 261 251 252
f 261 252 253
f 261 253 254
f 261 254 249
f 262 256 255
f 262 257 256
f 262 258 257
f 262 259 258
f 262 260 259
f 262 255 260
f 263 270 271 264
f 264 271 272 265
f 265 272 273 266
f 266 273 274 267
f 267 274 275 268
f 268 275 276 269
f 270 277 278 271
f 271 278 279 272
f 272 279 280 273
f 273 280 281 274
f 274 281 282 275
f 275 282 283 276
f 277 284 285 278
f 278 285 286 279
f 279 286 287 280
f 280 287 288 281
f 281 288 289 282
f 282 289 290 283
f 284 291 292 285
f 285 292 293 286
f 286 293 294 287
f 287 294 295 288
f 288 295 296 289
f 289 296 297 290
f 291 298 299 292
f 292 299 300 293
f 293 300 301 294
f 294 301 302 295
f 295 302 303 296
f 296 303 304 297
f 298 305 306 299
f 299 306 307 300
f 300 307 308 301
f 301 308 309 302
f 302 309 310 303
f 303 310 311 304
o Double window 2
v 2.1 -0.025 0.75
v 2.95 -0.025 0.75
v 2.95 0.025 0.75
v 2.1 0.025 0.75
v 2.1 -0.025 2.25
v 2.95 -0.025 2.25
v 2.95 0.025 2.25
v 2.1 0.025 2.25
v 3.05 -0.025 0.75
v 3.9 -0.025 0.75
v 3.9 0.025 0.75
v 3.05 0.025 0.75
v 3.05 -0.025 2.25
v 3.9 -0.025 2.25
v 3.9 0.025 2.25
v 3.05 0.025 2.25
f 312 313 314 315
f 316 319 318 317
f 312 316 317 313
f 313 317 318 314
f 314 318 319 315
f 315 319 316 312
f 320 321 322 323
f 324 327 326 325
f 320 324 325 321
f 321 325 326 322
f 322 326 327 323
f 323 327 324 320
o Wall shelf
v 0.5 0.0 1.475
v 1.5 0.0 1.475
v 1.5 0.3 1.475
v 0.5 0.3 1.475
v 0.5 0.0 1.525
v 1.5 0.0 1.525
v 1.5 0.3 1.525
v 0.5 0.3 1.525
f 328 329 330 331
f 332 335 334 333
f 328 332 333 329
f 329 333 334 330
f 330 334 335 331
f 331 335 332 328
o Amazon Echo 2
v 1.244 0.15 1.53
v 1.2355967477524976 0.17586255110086882 1.53
v 1.2135967477524976 0.19184648671698673 1.53
v 1.1864032522475023 0.19184648671698676 1.53
v 1.1644032522475023 0.17586255110086882 1.53
v 1.156 0.15 1.53
v 1.1644032522475023 0.12413744889913118 1.53
v 1.1864032522475023 0.10815351328301324 1.53
v 1.2135967477524976 0.10815351328301323 1.53
v 1.2355967477524976 0.12413744889913117 1.53
v 1.244 0.15 1.678
v 1.2355967477524976 0.17586255110086882 1.678
v 1.2135967477524976 0.19184648671698673 1.678
v 1.1864032522475023 0.19184648671698676 1.678
v 1.1644032522475023 0.17586255110086882 1.678
v 1.156 0.15 1.678
v 1.1644032522475023 0.12413744889913118 1.678
v 1.1864032522475023 0.10815351328301324 1.678
v 1.2135967477524976 0.10815351328301323 1.678
v 1.2355967477524976 0.12413744889913117 1.678
v 1.2 0.15 1.53
v 1.2 0.15 1.678
f 336 346 347 337
f 337 347 348 338
f 338 348 349 339
f 339 349 350 340
f 340 350 351 341
f 341 351 352 342
f 342 352 353 343
f 343 353 354 344
f 344 354 355 345
f 345 355 346 336
f 356 336 337
f 356 337 338
f 356 338 339
f 356 339 340
f 356 340 341
f 356 341 342
f 356 342 343
f 356 343 344
f 356 344 345
f 356 345 336
f 357 347 346
f 357 348 347
f 357 349 348
f 357 350 349
f 357 351 350
f 357 352 351
f 357 353 352
f 357 354 353
f 357 355 354
f 357 346 355
`;
        const loader = new OBJLoader();
        const object = loader.parse(objContent);
        
        const box = new THREE.Box3().setFromObject(object);
        const size = box.getSize(new THREE.Vector3());
        const center = box.getCenter(new THREE.Vector3());

        object.position.sub(center);
        scene.add(object);
        
        const maxDim = Math.max(size.x, size.y, size.z);
        const fov = camera.fov * (Math.PI / 180);
        const cameraDistance = maxDim / (2 * Math.tan(fov / 2));
        
        camera.position.y = -cameraDistance * 1.5;
        camera.lookAt(0, 0, 0);

        controls.target.set(0, 0, 0);
        controls.update();

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(0, -1, 1);
        scene.add(directionalLight);

        // --- Interactivity ---
        const objectMap = {};
        const allEdges = [];
        const allVertices = [];

        object.children.forEach(child => {
            objectMap[child.name] = child;
            child.traverse(node => {
                if (node.isMesh) {
                    node.userData.originalMaterial = node.material;

                    // Edges
                    const edges = new THREE.EdgesGeometry(node.geometry);
                    const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x000000 }));
                    node.add(line);
                    allEdges.push(line);

                    // Vertices
                    const pointsMaterial = new THREE.PointsMaterial({ color: 0x0000ff, size: 0.05 });
                    const points = new THREE.Points(node.geometry, pointsMaterial);
                    node.add(points);
                    allVertices.push(points);
                }
            });
        });

        // --- Add Receivers ---
        const receiversData = JSON.parse(`[{"name": "MonoMic", "position": [1.2, 0.25, 1.7], "radius": 0.15, "type": "mono"}]`);
        receiversData.forEach(receiver => {
            const receiverGroup = new THREE.Group();
            receiverGroup.name = receiver.name;

            if (receiver.type === 'ambisonic') {
                const bodyRadius = receiver.radius;
                const capsuleRadius = 0.02;
                const capsuleDist = bodyRadius + 0.01;

                // Main body
                const bodyGeom = new THREE.SphereGeometry(bodyRadius, 16, 16);
                const bodyMat = new THREE.MeshStandardMaterial({ color: 0xadd8e6, roughness: 0.1, metalness: 0.1 });
                const bodySphere = new THREE.Mesh(bodyGeom, bodyMat);
                receiverGroup.add(bodySphere);

                // Capsules
                const capsuleGeom = new THREE.SphereGeometry(capsuleRadius, 8, 8);
                const matX = new THREE.MeshStandardMaterial({ color: 0xff0000 }); // Red for X
                const matY = new THREE.MeshStandardMaterial({ color: 0x00ff00 }); // Green for Y
                const matZ = new THREE.MeshStandardMaterial({ color: 0x0000ff }); // Blue for Z

                const x_axis = new THREE.Vector3().fromArray(receiver.x_axis);
                const y_axis = new THREE.Vector3().fromArray(receiver.y_axis);
                const z_axis = new THREE.Vector3().fromArray(receiver.z_axis);

                const axes = [{ axis: x_axis, mat: matX }, { axis: y_axis, mat: matY }, { axis: z_axis, mat: matZ }];
                axes.forEach(item => {
                    const pos_cap = new THREE.Mesh(capsuleGeom, item.mat);
                    pos_cap.position.copy(item.axis).multiplyScalar(capsuleDist);
                    receiverGroup.add(pos_cap);
                    
                    const neg_cap = new THREE.Mesh(capsuleGeom, item.mat);
                    neg_cap.position.copy(item.axis).multiplyScalar(-capsuleDist);
                    receiverGroup.add(neg_cap);
                });

            } else { // Mono
                const monoRadius = 0.05; // Use a smaller, fixed radius for mono mics
                const geometry = new THREE.SphereGeometry(monoRadius, 16, 16);
                const material = new THREE.MeshStandardMaterial({ color: 0xadd8e6, roughness: 0.1, metalness: 0.1 });
                const sphere = new THREE.Mesh(geometry, material);
                receiverGroup.add(sphere);
            }
            
            receiverGroup.position.set(receiver.position[0], receiver.position[1], receiver.position[2]);
            receiverGroup.position.sub(center); // Adjust position relative to centered room
            
            receiverGroup.traverse(node => {
                if (node.isMesh) {
                    node.userData.originalMaterial = node.material;
                }
            });
            
            scene.add(receiverGroup);
            objectMap[receiver.name] = receiverGroup;
        });

        // --- Add Sources ---
        const sourcesData = JSON.parse(`[{"name": "Speaker 1", "position": [0.7, 1.5, 1.5], "orientation": [1.0, 0.0, 0.0], "directivity": "cardioid"}, {"name": "Speaker 2", "position": [3.3, 1.5, 1.5], "orientation": [-1.0, 0.0, 0.0], "directivity": "cardioid"}, {"name": "Background Noise", "position": [0.1, 0.1, 2.4], "orientation": [1.0, 0.0, 0.0], "directivity": "omnidirectional"}]`);
        sourcesData.forEach(source => {
            const sourceGroup = new THREE.Group();
            sourceGroup.name = source.name;

            const sourceRadius = 0.06;
            const geometry = new THREE.SphereGeometry(sourceRadius, 16, 16);
            const material = new THREE.MeshStandardMaterial({ color: 0xff0000, roughness: 0.1, metalness: 0.1 });
            const sphere = new THREE.Mesh(geometry, material);
            sourceGroup.add(sphere);

            if (source.directivity !== 'omnidirectional') {
                const dir = new THREE.Vector3().fromArray(source.orientation);
                const arrow = new THREE.ArrowHelper(dir, new THREE.Vector3(0, 0, 0), 0.3, 0xff0000, 0.1, 0.05);
                sourceGroup.add(arrow);
            }

            sourceGroup.position.set(source.position[0], source.position[1], source.position[2]);
            sourceGroup.position.sub(center); // Adjust position relative to centered room
            
            sourceGroup.traverse(node => {
                if (node.isMesh) {
                    node.userData.originalMaterial = node.material;
                }
            });
            
            scene.add(sourceGroup);
            objectMap[source.name] = sourceGroup;
        });

        const objectsData = JSON.parse(`[{"name": "Floor", "description": "Carpet", "type": "wall"}, {"name": "Ceiling", "description": "Plaster", "type": "wall"}, {"name": "Front", "description": "Concrete", "type": "wall"}, {"name": "Back", "description": "Concrete", "type": "wall"}, {"name": "Left", "description": "Concrete", "type": "wall"}, {"name": "Right", "description": "Concrete", "type": "wall"}, {"name": "Person 1", "description": "Human", "type": "furniture"}, {"name": "Person 2", "description": "Human", "type": "furniture"}, {"name": "Chair", "description": "Wood", "type": "furniture"}, {"name": "Couch", "description": "Fabric", "type": "furniture"}, {"name": "CoffeeTable", "description": "Wood", "type": "furniture"}, {"name": "Door 1", "description": "Wood", "type": "furniture"}, {"name": "Double window 2", "description": "Glass", "type": "furniture"}, {"name": "Wall shelf", "description": "Wood", "type": "furniture"}, {"name": "Amazon Echo 2", "description": "Fabric", "type": "furniture"}, {"name": "MonoMic", "description": "Mono Receiver", "type": "receiver"}, {"name": "Speaker 1", "description": "Source (cardioid)", "type": "source"}, {"name": "Speaker 2", "description": "Source (cardioid)", "type": "source"}, {"name": "Background Noise", "description": "Source", "type": "source"}]`);
        const objectList = document.getElementById('objectList');

        objectsData.forEach(objData => {
            const name = objData.name;
            const description = objData.description;

            const li = document.createElement('li');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = true;
            checkbox.id = `check-${name}`;
            checkbox.dataset.name = name;
            
            const label = document.createElement('label');
            label.htmlFor = `check-${name}`;
            label.className = 'object-label';
            
            const nameSpan = document.createElement('span');
            nameSpan.className = 'name';
            nameSpan.textContent = name;
            
            const descSpan = document.createElement('span');
            descSpan.className = 'description';
            descSpan.textContent = ` - ${description}`;
            
            label.appendChild(nameSpan);
            label.appendChild(descSpan);
            
            li.appendChild(checkbox);
            li.appendChild(label);
            objectList.appendChild(li);

            checkbox.addEventListener('change', (event) => {
                const objectToShowOrHide = objectMap[event.target.dataset.name];
                if (objectToShowOrHide) {
                    objectToShowOrHide.visible = event.target.checked;
                }
            });
        });

        const transparencyToggle = document.getElementById('transparencyToggle');
        const edgesToggle = document.getElementById('edgesToggle');
        const verticesToggle = document.getElementById('verticesToggle');
        const furnitureToggle = document.getElementById('furnitureToggle');
        
        function setTransparency(isTransparent) {
            for (const name in objectMap) {
                const obj = objectMap[name];
                obj.traverse(node => {
                    if (node.isMesh) {
                        if (isTransparent) {
                            if (!node.userData.transparentMaterial) {
                                const newMaterial = node.material.clone();
                                newMaterial.transparent = true;
                                const lowerName = name.toLowerCase();
                                if (lowerName.includes('mic')) {
                                    newMaterial.opacity = 0.6;
                                } else if (lowerName.includes('wall') || lowerName.includes('ceiling') || lowerName.includes('floor') || lowerName.includes('window')) {
                                    newMaterial.opacity = 0.2;
                                } else if (lowerName.includes('source') || lowerName.includes('speaker')) {
                                    newMaterial.opacity = 0.6;
                                } else {
                                    newMaterial.opacity = 0.5;
                                }
                                node.userData.transparentMaterial = newMaterial;
                            }
                            node.material = node.userData.transparentMaterial;
                        } else {
                            node.material = node.userData.originalMaterial;
                        }
                    }
                });
            }
        }

        function setEdgesVisibility(visible) {
            allEdges.forEach(edge => {
                edge.visible = visible;
            });
        }

        function setVerticesVisibility(visible) {
            allVertices.forEach(vertex => {
                vertex.visible = visible;
            });
        }

        function setFurnitureVisibility(visible) {
            objectsData.forEach(objData => {
                if (objData.type === 'furniture') {
                    const objectToToggle = objectMap[objData.name];
                    if (objectToToggle) {
                        objectToToggle.visible = visible;
                        // Also update the individual checkbox for this item
                        const checkbox = document.getElementById(`check-${objData.name}`);
                        if (checkbox) {
                            checkbox.checked = visible;
                        }
                    }
                }
            });
        }

        transparencyToggle.addEventListener('change', (event) => {
            setTransparency(event.target.checked);
        });

        edgesToggle.addEventListener('change', (event) => {
            setEdgesVisibility(event.target.checked);
        });

        verticesToggle.addEventListener('change', (event) => {
            setVerticesVisibility(event.target.checked);
        });

        furnitureToggle.addEventListener('change', (event) => {
            setFurnitureVisibility(event.target.checked);
        });
        
        // Set initial state from checkbox
        setTransparency(transparencyToggle.checked);
        setEdgesVisibility(edgesToggle.checked);
        setVerticesVisibility(verticesToggle.checked);
        setFurnitureVisibility(furnitureToggle.checked);
        
        const cameraPositionEl = document.getElementById('camera-position');
        const cameraRotationEl = document.getElementById('camera-rotation');
        
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);

            // Update camera info
            cameraPositionEl.textContent = `Position: (${camera.position.x.toFixed(2)}, ${camera.position.y.toFixed(2)}, ${camera.position.z.toFixed(2)})`;
            cameraRotationEl.textContent = `Rotation: (${(camera.rotation.x * 180 / Math.PI).toFixed(2)}, ${(camera.rotation.y * 180 / Math.PI).toFixed(2)}, ${(camera.rotation.z * 180 / Math.PI).toFixed(2)})`;
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }, false);
    </script>
</body>
</html>